{
    "version": "2",
    "pipelines": [
        {
            "name": "build",
            "runner": "org.osbuild.linux",
            "stages": [
                {
                    "type": "org.osbuild.container-deploy",
                    "inputs": {
                        "images": {
                            "type": "org.osbuild.containers-storage",
                            "origin": "org.osbuild.source",
                            "references": {
                                "sha256:776c80544eb9596f2d2a4aa9971efba1f1ac024cb9ea0ae7da59092860943f43": {
                                    "name": "quay.io/centos-bootc/centos-bootc:stream10"
                                }
                            }
                        }
                    },
                    "options": {
                        "remove-signatures": true
                    }
                },
                {
                    "type": "org.osbuild.selinux",
                    "options": {
                        "file_contexts": "etc/selinux/targeted/contexts/files/file_contexts",
                        "exclude_paths": [
                            "/sysroot"
                        ],
                        "labels": {
                            "/usr/bin/mount": "system_u:object_r:install_exec_t:s0",
                            "/usr/bin/ostree": "system_u:object_r:install_exec_t:s0",
                            "/usr/bin/umount": "system_u:object_r:install_exec_t:s0"
                        }
                    }
                }
            ]
        },
        {
            "name": "image",
            "build": "name:build",
            "stages": [
                {
                    "type": "org.osbuild.truncate",
                    "options": {
                        "filename": "disk.raw",
                        "size": "10737418240"
                    }
                },
                {
                    "type": "org.osbuild.sfdisk",
                    "options": {
                        "label": "gpt",
                        "uuid": "f7a62cb0-5eda-42b0-9d4f-075d878fb005",
                        "partitions": [
                            {
                                "bootable": true,
                                "size": 2048,
                                "start": 2048,
                                "type": "21686148-6449-6E6F-744E-656564454649",
                                "uuid": "20d97fd8-dd1e-4700-ae25-d1445fac35e3"
                            },
                            {
                                "size": 1026048,
                                "start": 4096,
                                "type": "C12A7328-F81F-11D2-BA4B-00A0C93EC93B",
                                "uuid": "5e5ac41f-f567-407d-83e6-ef1953720aa1"
                            },
                            {
                                "size": 2097152,
                                "start": 1030144,
                                "type": "0FC63DAF-8483-4772-8E79-3D69D8477DE4",
                                "uuid": "5a80b3a3-cab9-422a-bf4c-e524d5440665"
                            },
                            {
                                "size": 17844191,
                                "start": 3127296,
                                "type": "0FC63DAF-8483-4772-8E79-3D69D8477DE4",
                                "uuid": "0e6757e8-d908-487f-a098-fa73aed5f6aa"
                            }
                        ]
                    },
                    "devices": {
                        "device": {
                            "type": "org.osbuild.loopback",
                            "options": {
                                "filename": "disk.raw",
                                "lock": true
                            }
                        }
                    }
                },
                {
                    "type": "org.osbuild.mkfs.fat",
                    "options": {
                        "volid": "0304AFBC",
                        "label": "EFI-SYSTEM"
                    },
                    "devices": {
                        "device": {
                            "type": "org.osbuild.loopback",
                            "options": {
                                "filename": "disk.raw",
                                "start": 4096,
                                "size": 1026048,
                                "lock": true
                            }
                        }
                    }
                },
                {
                    "type": "org.osbuild.mkfs.xfs",
                    "options": {
                        "uuid": "6212ac53-a729-4aed-ba61-3abf142819d3",
                        "label": "boot"
                    },
                    "devices": {
                        "device": {
                            "type": "org.osbuild.loopback",
                            "options": {
                                "filename": "disk.raw",
                                "start": 1030144,
                                "size": 2097152,
                                "lock": true
                            }
                        }
                    }
                },
                {
                    "type": "org.osbuild.mkfs.xfs",
                    "options": {
                        "uuid": "d520091f-f4bf-46a6-a224-79e7658033be",
                        "label": "root"
                    },
                    "devices": {
                        "device": {
                            "type": "org.osbuild.loopback",
                            "options": {
                                "filename": "disk.raw",
                                "start": 3127296,
                                "size": 17844191,
                                "lock": true
                            }
                        }
                    }
                },
                {
                    "type": "org.osbuild.bootc.install-to-filesystem",
                    "inputs": {
                        "images": {
                            "type": "org.osbuild.containers-storage",
                            "origin": "org.osbuild.source",
                            "references": {
                                "sha256:776c80544eb9596f2d2a4aa9971efba1f1ac024cb9ea0ae7da59092860943f43": {
                                    "name": "quay.io/centos-bootc/centos-bootc:stream10"
                                }
                            }
                        }
                    },
                    "options": {
                        "kernel-args": [
                            "rw",
                            "console=tty0",
                            "console=ttyS0"
                        ],
                        "target-imgref": "quay.io/centos-bootc/centos-bootc:stream10"
                    },
                    "devices": {
                        "disk": {
                            "type": "org.osbuild.loopback",
                            "options": {
                                "filename": "disk.raw",
                                "partscan": true
                            }
                        }
                    },
                    "mounts": [
                        {
                            "name": "-",
                            "type": "org.osbuild.xfs",
                            "source": "disk",
                            "target": "/",
                            "partition": 4
                        },
                        {
                            "name": "boot",
                            "type": "org.osbuild.xfs",
                            "source": "disk",
                            "target": "/boot",
                            "partition": 3
                        },
                        {
                            "name": "boot-efi",
                            "type": "org.osbuild.fat",
                            "source": "disk",
                            "target": "/boot/efi",
                            "partition": 2
                        }
                    ]
                },
                {
                    "type": "org.osbuild.systemd.unit.create",
                    "options": {
                        "filename": "-.mount",
                        "unit-path": "etc",
                        "config": {
                            "Unit": {
                                "DefaultDependencies": true
                            },
                            "Mount": {
                                "What": "/dev/disk/by-uuid/d520091f-f4bf-46a6-a224-79e7658033be",
                                "Where": "/",
                                "Type": "xfs",
                                "Options": "ro"
                            },
                            "Install": {
                                "WantedBy": [
                                    "multi-user.target"
                                ]
                            }
                        }
                    },
                    "devices": {
                        "disk": {
                            "type": "org.osbuild.loopback",
                            "options": {
                                "filename": "disk.raw",
                                "partscan": true
                            }
                        }
                    },
                    "mounts": [
                        {
                            "name": "-",
                            "type": "org.osbuild.xfs",
                            "source": "disk",
                            "target": "/",
                            "partition": 4
                        },
                        {
                            "name": "boot",
                            "type": "org.osbuild.xfs",
                            "source": "disk",
                            "target": "/boot",
                            "partition": 3
                        },
                        {
                            "name": "boot-efi",
                            "type": "org.osbuild.fat",
                            "source": "disk",
                            "target": "/boot/efi",
                            "partition": 2
                        },
                        {
                            "name": "ostree.deployment",
                            "type": "org.osbuild.ostree.deployment",
                            "options": {
                                "source": "mount",
                                "deployment": {
                                    "default": true
                                }
                            }
                        },
                        {
                            "name": "bind-ostree-deployment-to-tree",
                            "type": "org.osbuild.bind",
                            "target": "tree://",
                            "options": {
                                "source": "mount://"
                            }
                        }
                    ]
                },
                {
                    "type": "org.osbuild.systemd.unit.create",
                    "options": {
                        "filename": "boot-efi.mount",
                        "unit-path": "etc",
                        "config": {
                            "Unit": {
                                "DefaultDependencies": true
                            },
                            "Mount": {
                                "What": "/dev/disk/by-uuid/0304-AFBC",
                                "Where": "/boot/efi",
                                "Type": "vfat",
                                "Options": "umask=0077,shortname=winnt"
                            },
                            "Install": {
                                "WantedBy": [
                                    "multi-user.target"
                                ]
                            }
                        }
                    },
                    "devices": {
                        "disk": {
                            "type": "org.osbuild.loopback",
                            "options": {
                                "filename": "disk.raw",
                                "partscan": true
                            }
                        }
                    },
                    "mounts": [
                        {
                            "name": "-",
                            "type": "org.osbuild.xfs",
                            "source": "disk",
                            "target": "/",
                            "partition": 4
                        },
                        {
                            "name": "boot",
                            "type": "org.osbuild.xfs",
                            "source": "disk",
                            "target": "/boot",
                            "partition": 3
                        },
                        {
                            "name": "boot-efi",
                            "type": "org.osbuild.fat",
                            "source": "disk",
                            "target": "/boot/efi",
                            "partition": 2
                        },
                        {
                            "name": "ostree.deployment",
                            "type": "org.osbuild.ostree.deployment",
                            "options": {
                                "source": "mount",
                                "deployment": {
                                    "default": true
                                }
                            }
                        },
                        {
                            "name": "bind-ostree-deployment-to-tree",
                            "type": "org.osbuild.bind",
                            "target": "tree://",
                            "options": {
                                "source": "mount://"
                            }
                        }
                    ]
                },
                {
                    "type": "org.osbuild.systemd.unit.create",
                    "options": {
                        "filename": "boot.mount",
                        "unit-path": "etc",
                        "config": {
                            "Unit": {
                                "DefaultDependencies": true
                            },
                            "Mount": {
                                "What": "/dev/disk/by-uuid/6212ac53-a729-4aed-ba61-3abf142819d3",
                                "Where": "/boot",
                                "Type": "xfs",
                                "Options": "ro"
                            },
                            "Install": {
                                "WantedBy": [
                                    "multi-user.target"
                                ]
                            }
                        }
                    },
                    "devices": {
                        "disk": {
                            "type": "org.osbuild.loopback",
                            "options": {
                                "filename": "disk.raw",
                                "partscan": true
                            }
                        }
                    },
                    "mounts": [
                        {
                            "name": "-",
                            "type": "org.osbuild.xfs",
                            "source": "disk",
                            "target": "/",
                            "partition": 4
                        },
                        {
                            "name": "boot",
                            "type": "org.osbuild.xfs",
                            "source": "disk",
                            "target": "/boot",
                            "partition": 3
                        },
                        {
                            "name": "boot-efi",
                            "type": "org.osbuild.fat",
                            "source": "disk",
                            "target": "/boot/efi",
                            "partition": 2
                        },
                        {
                            "name": "ostree.deployment",
                            "type": "org.osbuild.ostree.deployment",
                            "options": {
                                "source": "mount",
                                "deployment": {
                                    "default": true
                                }
                            }
                        },
                        {
                            "name": "bind-ostree-deployment-to-tree",
                            "type": "org.osbuild.bind",
                            "target": "tree://",
                            "options": {
                                "source": "mount://"
                            }
                        }
                    ]
                },
                {
                    "type": "org.osbuild.systemd",
                    "options": {
                        "enabled_services": [
                            "-.mount",
                            "boot-efi.mount",
                            "boot.mount"
                        ]
                    },
                    "devices": {
                        "disk": {
                            "type": "org.osbuild.loopback",
                            "options": {
                                "filename": "disk.raw",
                                "partscan": true
                            }
                        }
                    },
                    "mounts": [
                        {
                            "name": "-",
                            "type": "org.osbuild.xfs",
                            "source": "disk",
                            "target": "/",
                            "partition": 4
                        },
                        {
                            "name": "boot",
                            "type": "org.osbuild.xfs",
                            "source": "disk",
                            "target": "/boot",
                            "partition": 3
                        },
                        {
                            "name": "boot-efi",
                            "type": "org.osbuild.fat",
                            "source": "disk",
                            "target": "/boot/efi",
                            "partition": 2
                        },
                        {
                            "name": "ostree.deployment",
                            "type": "org.osbuild.ostree.deployment",
                            "options": {
                                "source": "mount",
                                "deployment": {
                                    "default": true
                                }
                            }
                        },
                        {
                            "name": "bind-ostree-deployment-to-tree",
                            "type": "org.osbuild.bind",
                            "target": "tree://",
                            "options": {
                                "source": "mount://"
                            }
                        }
                    ]
                },
                {
                    "type": "org.osbuild.selinux",
                    "options": {
                        "target": "tree:///etc",
                        "file_contexts": "etc/selinux/targeted/contexts/files/file_contexts",
                        "exclude_paths": [
                            "/sysroot"
                        ]
                    },
                    "devices": {
                        "disk": {
                            "type": "org.osbuild.loopback",
                            "options": {
                                "filename": "disk.raw",
                                "partscan": true
                            }
                        }
                    },
                    "mounts": [
                        {
                            "name": "-",
                            "type": "org.osbuild.xfs",
                            "source": "disk",
                            "target": "/",
                            "partition": 4
                        },
                        {
                            "name": "boot",
                            "type": "org.osbuild.xfs",
                            "source": "disk",
                            "target": "/boot",
                            "partition": 3
                        },
                        {
                            "name": "boot-efi",
                            "type": "org.osbuild.fat",
                            "source": "disk",
                            "target": "/boot/efi",
                            "partition": 2
                        },
                        {
                            "name": "ostree.deployment",
                            "type": "org.osbuild.ostree.deployment",
                            "options": {
                                "source": "mount",
                                "deployment": {
                                    "default": true
                                }
                            }
                        },
                        {
                            "name": "bind-ostree-deployment-to-tree",
                            "type": "org.osbuild.bind",
                            "target": "tree://",
                            "options": {
                                "source": "mount://"
                            }
                        }
                    ]
                },
                {
                    "type": "org.osbuild.selinux",
                    "options": {
                        "target": "tree:///var",
                        "file_contexts": "etc/selinux/targeted/contexts/files/file_contexts",
                        "exclude_paths": [
                            "/sysroot"
                        ]
                    },
                    "devices": {
                        "disk": {
                            "type": "org.osbuild.loopback",
                            "options": {
                                "filename": "disk.raw",
                                "partscan": true
                            }
                        }
                    },
                    "mounts": [
                        {
                            "name": "-",
                            "type": "org.osbuild.xfs",
                            "source": "disk",
                            "target": "/",
                            "partition": 4
                        },
                        {
                            "name": "boot",
                            "type": "org.osbuild.xfs",
                            "source": "disk",
                            "target": "/boot",
                            "partition": 3
                        },
                        {
                            "name": "boot-efi",
                            "type": "org.osbuild.fat",
                            "source": "disk",
                            "target": "/boot/efi",
                            "partition": 2
                        },
                        {
                            "name": "ostree.deployment",
                            "type": "org.osbuild.ostree.deployment",
                            "options": {
                                "source": "mount",
                                "deployment": {
                                    "default": true
                                }
                            }
                        },
                        {
                            "name": "bind-ostree-deployment-to-tree",
                            "type": "org.osbuild.bind",
                            "target": "tree://",
                            "options": {
                                "source": "mount://"
                            }
                        }
                    ]
                }
            ]
        },
        {
            "name": "qcow2",
            "stages": [
                {
                    "type": "org.osbuild.qemu",
                    "inputs": {
                        "image": {
                            "type": "org.osbuild.files",
                            "origin": "org.osbuild.pipeline",
                            "references": {
                                "name:image": {
                                    "file": "disk.raw"
                                }
                            }
                        }
                    },
                    "options": {
                        "filename": "disk.qcow2",
                        "format": {
                            "type": "qcow2",
                            "compat": "1.1"
                        }
                    }
                }
            ]
        },
        {
            "name": "vmdk",
            "stages": [
                {
                    "type": "org.osbuild.qemu",
                    "inputs": {
                        "image": {
                            "type": "org.osbuild.files",
                            "origin": "org.osbuild.pipeline",
                            "references": {
                                "name:image": {
                                    "file": "disk.raw"
                                }
                            }
                        }
                    },
                    "options": {
                        "filename": "disk.vmdk",
                        "format": {
                            "type": "vmdk",
                            "subformat": "streamOptimized"
                        }
                    }
                }
            ]
        },
        {
            "name": "vpc",
            "stages": [
                {
                    "type": "org.osbuild.qemu",
                    "inputs": {
                        "image": {
                            "type": "org.osbuild.files",
                            "origin": "org.osbuild.pipeline",
                            "references": {
                                "name:image": {
                                    "file": "disk.raw"
                                }
                            }
                        }
                    },
                    "options": {
                        "filename": "disk.vhd",
                        "format": {
                            "type": "vpc"
                        }
                    }
                }
            ]
        },
        {
            "name": "ovf",
            "stages": [
                {
                    "type": "org.osbuild.copy",
                    "inputs": {
                        "vmdk-tree": {
                            "type": "org.osbuild.tree",
                            "origin": "org.osbuild.pipeline",
                            "references": [
                                "name:vmdk"
                            ]
                        }
                    },
                    "options": {
                        "paths": [
                            {
                                "from": "input://vmdk-tree/disk.vmdk",
                                "to": "tree:///"
                            }
                        ]
                    }
                },
                {
                    "type": "org.osbuild.ovf",
                    "options": {
                        "vmdk": "disk.vmdk"
                    }
                }
            ]
        },
        {
            "name": "archive",
            "stages": [
                {
                    "type": "org.osbuild.tar",
                    "inputs": {
                        "tree": {
                            "type": "org.osbuild.tree",
                            "origin": "org.osbuild.pipeline",
                            "references": [
                                "name:ovf"
                            ]
                        }
                    },
                    "options": {
                        "filename": "disk.ova",
                        "format": "ustar",
                        "paths": [
                            "disk.ovf",
                            "disk.mf",
                            "disk.vmdk"
                        ]
                    }
                }
            ]
        },
        {
            "name": "gce",
            "build": "name:build",
            "stages": [
                {
                    "type": "org.osbuild.tar",
                    "inputs": {
                        "tree": {
                            "type": "org.osbuild.tree",
                            "origin": "org.osbuild.pipeline",
                            "references": [
                                "name:image"
                            ]
                        }
                    },
                    "options": {
                        "filename": "image.tar.gz",
                        "format": "oldgnu",
                        "acls": false,
                        "selinux": false,
                        "xattrs": false,
                        "root-node": "omit"
                    }
                }
            ]
        }
    ],
    "sources": {
        "org.osbuild.containers-storage": {
            "items": {
                "sha256:776c80544eb9596f2d2a4aa9971efba1f1ac024cb9ea0ae7da59092860943f43": {}
            }
        }
    }
}
